# 记忆功能验证步骤

## 测试场景1: 基础记忆提取和存储

1. 打开聊天页面: http://localhost:3000/chat
2. 发送包含拖延原因的消息:
   ```
   我总是觉得任务太难了，完美主义让我不敢开始，害怕做不好
   ```
3. 等待AI回复（应该包含行动步骤）
4. 打开浏览器开发者工具，在控制台中检查记忆:
   ```javascript
   // 检查localStorage中的记忆
   console.log('记忆数据:', JSON.parse(localStorage.getItem('momentum-memory-v1') || '[]'))
   ```

## 测试场景2: 记忆检索和注入

1. 开始新的会话或继续上一个会话
2. 发送新消息:
   ```
   我又开始拖延了，不知道怎么开始
   ```
3. 检查网络请求中是否包含记忆前缀:
   - 打开开发者工具 -> Network 标签
   - 发送消息后查看 `/api/chat/stream` 请求
   - 检查请求体中的 messages 数组是否包含 system 消息（记忆前缀）

## 测试场景3: 对话摘要

1. 在同一会话中发送多条消息（超过30条或6000字符）
2. 检查是否触发对话摘要机制
3. 查看网络请求中是否包含摘要的 system 消息

## 测试场景4: 跨会话记忆

1. 完成场景1后，刷新页面或开始新会话
2. 发送相关的拖延问题
3. 检查AI回复是否体现了之前的记忆内容

## 验证要点

- ✅ 用户输入中的拖延原因被正确提取并保存
- ✅ AI回复中的行动步骤被正确提取并保存
- ✅ 记忆检索能根据当前输入返回相关记忆
- ✅ 记忆前缀被正确注入到API请求中
- ✅ 长对话触发摘要机制
- ✅ 跨会话记忆生效
- ✅ 不保存敏感信息（只保存拖延相关内容）

## 调试工具

### 浏览器控制台命令:

```javascript
// 查看所有记忆
const memories = JSON.parse(localStorage.getItem('momentum-memory-v1') || '[]')
console.table(memories)

// 手动测试记忆检索
import { Memory } from '/lib/memory.js'
const preface = Memory.buildPreface('我又开始拖延了')
console.log('记忆前缀:', preface)

// 清空记忆（用于重新测试）
localStorage.removeItem('momentum-memory-v1')
```

### 测试页面:
访问 http://localhost:3000/test-memory 进行详细的功能测试

## 预期结果

1. **记忆提取**: 从 "我总是觉得任务太难了，完美主义让我不敢开始" 中提取出拖延原因
2. **记忆存储**: 记忆保存在 localStorage 的 'momentum-memory-v1' 键中
3. **记忆检索**: 当用户说 "我又开始拖延了" 时，能检索到相关的历史原因和方法
4. **记忆注入**: API请求中包含类似这样的 system 消息:
   ```
   以下是与该用户相关的已知信息（仅用于个性化建议，勿逐字复述）：
   - 拖延原因：觉得任务太难了；完美主义让我不敢开始
   - 最近确认的待办：先花5分钟列出任务的基本要求；选择其中最简单的一个部分开始
   ```
5. **对话摘要**: 长对话时自动生成摘要，保留最近10条消息
